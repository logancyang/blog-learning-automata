<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to setup local GPU server for fast.ai | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="How to setup local GPU server for fast.ai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="fast.ai note series" />
<meta property="og:description" content="fast.ai note series" />
<link rel="canonical" href="http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-27T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2019-05-27T00:00:00-05:00","dateModified":"2019-05-27T00:00:00-05:00","description":"fast.ai note series","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html"},"@type":"BlogPosting","url":"http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html","headline":"How to setup local GPU server for fast.ai","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to setup local GPU server for fast.ai | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="How to setup local GPU server for fast.ai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="fast.ai note series" />
<meta property="og:description" content="fast.ai note series" />
<link rel="canonical" href="http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-27T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2019-05-27T00:00:00-05:00","dateModified":"2019-05-27T00:00:00-05:00","description":"fast.ai note series","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html"},"@type":"BlogPosting","url":"http://blog.logancyang.com/note/fastai/2019/05/27/fastai-gpu-setup.html","headline":"How to setup local GPU server for fast.ai","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Learning Automata</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to setup local GPU server for fast.ai</h1><p class="page-description">fast.ai note series</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-05-27T00:00:00-05:00" itemprop="datePublished">
        May 27, 2019
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#note">note</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#fastai">fastai</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#server-setup-gpu-driver-and-cuda">Server setup: GPU driver and CUDA</a>
<ul>
<li class="toc-entry toc-h3"><a href="#preparation">Preparation</a></li>
<li class="toc-entry toc-h3"><a href="#install-cuda">Install CUDA</a></li>
<li class="toc-entry toc-h3"><a href="#install-cudnn">Install cuDNN</a></li>
<li class="toc-entry toc-h3"><a href="#update-your-bashrc">Update your .bashrc</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#server-setup-conda">Server Setup: Conda</a></li>
<li class="toc-entry toc-h2"><a href="#server-setup-fastai">Server Setup: fast.ai</a></li>
<li class="toc-entry toc-h2"><a href="#gpu-vs-cpu-for-deep-learning-test">GPU vs. CPU for Deep Learning Test</a></li>
<li class="toc-entry toc-h2"><a href="#set-up-ssh-connection">Set up SSH connection</a></li>
<li class="toc-entry toc-h2"><a href="#port-forwarding-to-acess-jupyter-notebook-lan">Port Forwarding to Acess Jupyter Notebook (LAN)</a></li>
<li class="toc-entry toc-h2"><a href="#setup-remote-ssh-access-waninternet">Setup Remote SSH Access (WAN/Internet)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#configure-router-for-port-forwarding">Configure Router for Port Forwarding</a></li>
<li class="toc-entry toc-h3"><a href="#ssh-from-remote">SSH from Remote</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#setup-jupyter-notebook-server-for-remote-access">Setup Jupyter Notebook Server for Remote Access</a></li>
<li class="toc-entry toc-h2"><a href="#side-note-github-https">Side Note: Github HTTPS</a></li>
<li class="toc-entry toc-h2"><a href="#side-note-ssh-port-forwarding-concepts">Side Note: SSH Port Forwarding Concepts</a></li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul><p>Fast.ai is the best coder’s guide to practical deep learning. This is a guide to its environment setup on a Linux server with NVIDIA GPU.</p>

<h2 id="server-setup-gpu-driver-and-cuda">
<a class="anchor" href="#server-setup-gpu-driver-and-cuda" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server setup: GPU driver and CUDA</h2>

<p>If you have an Nvidia GPU on your Linux machine, great! Let’s install the necessary components for deep learning.</p>

<h3 id="preparation">
<a class="anchor" href="#preparation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preparation</h3>

<p>Install some useful packages</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install \
  aptitude \
  freeglut3-dev \
  g++-4.8 \
  gcc-4.8 \
  libglu1-mesa-dev \
  libx11-dev \
  libxi-dev \
  libxmu-dev \
  nvidia-modprobe \
  python-dev \
  python-pip \
  python-virtualenv \
  vim
</code></pre></div></div>

<h3 id="install-cuda">
<a class="anchor" href="#install-cuda" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install CUDA</h3>

<p>Download CUDA installation file: https://developer.nvidia.com/cuda-downloads</p>

<p>Choose Linux -&gt; x86_64 -&gt; Ubuntu -&gt; 14.04 -&gt; deb (local)  -&gt; Download</p>

<p>Install CUDA in terminal (use the specific .deb file you’ve downloaded):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/Downloads
sudo dpkg -i cuda-repo-ubuntu1404-8-0-local-ga2_8.0.61-1_amd64.deb
sudo apt-get update
sudo apt-get install cuda
</code></pre></div></div>

<p>Restart the computer to activate CUDA driver. Now your screen resolution should be automatically changed to highest resolution for the display!</p>

<h3 id="install-cudnn">
<a class="anchor" href="#install-cudnn" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install cuDNN</h3>

<p>The NVIDIA CUDA® Deep Neural Network library (cuDNN) is aGPU-accelerated library of primitives for deep neural networks with optimizations for convolutions etc.</p>

<p>Register an (free) acount on NVIDIA website and login to download the latest cuDNN library: https://developer.nvidia.com/cudnn</p>

<p>Choose the specific version of cuDNN (denpending on support of your prefered deep learning framework)</p>

<p>Choose Download cuDNN v5.1 (Jan 20, 2017), for CUDA 8.0 -&gt; cuDNN v5.1 Library for Linux</p>

<p>Install cuDNN (by copying files :) in terminal:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/Downloads
tar xvf cudnn-8.0-linux-x64-v5.1.tgz
cd cuda
sudo cp lib64/* /usr/local/cuda/lib64/
sudo cp include/cudnn.h /usr/local/cuda/include/
sudo chmod a+r /usr/local/cuda/lib64/libcudnn*
</code></pre></div></div>

<h3 id="update-your-bashrc">
<a class="anchor" href="#update-your-bashrc" aria-hidden="true"><span class="octicon octicon-link"></span></a>Update your .bashrc</h3>

<p>Add the following lines to your ~/.bashrc file (you can open it by gedit ~/.bashrc in terminal)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=/usr/local/cuda/bin:$PATH
export MANPATH=/usr/local/cuda/man:$MANPATH
export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
source ~/.bashrc
</code></pre></div></div>

<p>To check the installation, print some GPU and driver information by:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-smi
nvcc --version
</code></pre></div></div>

<p>Note: Haven’t been using my gpu server for a while and when I started Ubuntu in Jan 2020, the NVidia driver stopped working. First of all, the display resolution was messed up and I had to perform actions from my other machine via ssh. I had to update the driver but there were some hoops to jump through. There were some broken dependencies and I needed</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo aptitude install &lt;name_of_package_with_conflicts&gt;
</code></pre></div></div>

<p>to be able to run</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ubuntu-drivers autoinstall
</code></pre></div></div>

<p>reference: https://askubuntu.com/questions/1077493/unable-to-install-nvidia-drivers-on-ubuntu-18-04</p>

<h2 id="server-setup-conda">
<a class="anchor" href="#server-setup-conda" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server Setup: Conda</h2>

<p>Install Anaconda</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp
curl -O https://repo.anaconda.com/archive/Anaconda3-2019.03-Linux-x86_64.sh
sha256sum Anaconda3-2019.03-Linux-x86_64.sh
# output
# 45c851b7497cc14d5ca060064394569f724b67d9b5f98a926ed49b834a6bb73a  Anaconda3-2019.03-Linux-x86_64.sh

bash Anaconda3-2019.03-Linux-x86_64.sh
</code></pre></div></div>

<p>You’ll receive the following output to review the license agreement by pressing <code class="highlighter-rouge">ENTER</code> until you reach the end.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Output

Welcome to Anaconda3 2019.03

In order to continue the installation process, please review the license
agreement.
Please, press ENTER to continue
&gt;&gt;&gt;
...
Do you approve the license terms? [yes|no]
</code></pre></div></div>

<p>When you get to the end of the license, type yes as long as you agree to the license to complete installation.</p>

<p>Once you agree to the license, you will be prompted to choose the location of the installation. You can press <code class="highlighter-rouge">ENTER</code> to accept the default location, or specify a different location.</p>

<p>Once installation is complete and ran <code class="highlighter-rouge">conda init</code>, the following code is added to <code class="highlighter-rouge">.bashrc</code>. If you use <code class="highlighter-rouge">zsh</code>, add it to <code class="highlighter-rouge">.zshrc</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/loganyc/anaconda3/bin/conda' 'shell.bash' 'hook' 2&gt; /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/home/loganyc/anaconda3/etc/profile.d/conda.sh" ]; then
        . "/home/loganyc/anaconda3/etc/profile.d/conda.sh"
    else
        export PATH="/home/loganyc/anaconda3/bin:$PATH"
    fi
fi
unset __conda_setup
# &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</code></pre></div></div>

<p>Use the conda command to test the installation and activation:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda list
</code></pre></div></div>

<p>To setup conda environment,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create --name my_env python=3
conda activate my_env
</code></pre></div></div>

<p>To deactivate conda env</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda deactivate
</code></pre></div></div>

<p>(Note if you use zsh, there can be a <code class="highlighter-rouge">(base)</code> shown as the default conda environment.)</p>

<h2 id="server-setup-fastai">
<a class="anchor" href="#server-setup-fastai" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server Setup: fast.ai</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/fastai/course-v3
conda update conda
conda install -c pytorch -c fastai fastai pytorch torchvision cuda92 jupyter
cd course-v3/nbs/dl1
jupyter notebook
</code></pre></div></div>

<p>In your terminal, and you can access the notebook at localhost:8888.</p>

<p>If going to localhost:8888 doesn’t work, or asks for a password/token return to your terminal window and look for this message after you typed ‘jupyter notebook’: “Copy/paste this URL into your browser when you connect for the first time, to login with a token:”</p>

<p>Copy and paste that URL into your browser, and this should connect you to your jupyter notebook.</p>

<p>Go back to the first page to see how to use this jupyter notebook and run the jupyter notebook tutorial. Come back here once you’re finished and don’t forget to stop your instance with the next step.</p>

<p>If you have any problem while using the fastai library try running</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install -c fastai fastai
</code></pre></div></div>

<p>Note that in Ubuntu terminal, use <code class="highlighter-rouge">ctrl+\</code> to stop the notebook server.</p>

<h2 id="gpu-vs-cpu-for-deep-learning-test">
<a class="anchor" href="#gpu-vs-cpu-for-deep-learning-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>GPU vs. CPU for Deep Learning Test</h2>

<p>Try running this inside a Jupyter Notebook:</p>

<p>Cell [1]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import torch
t_cpu = torch.rand(500,500,500)
%timeit t_cpu @ t_cpu
# Output
# 785 ms ± 14.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</code></pre></div></div>

<p>Cell [2]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>t_gpu = torch.rand(500,500,500).cuda()
%timeit t_gpu @ t_gpu
# Output
# 18.7 ms ± 376 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre></div></div>

<h2 id="set-up-ssh-connection">
<a class="anchor" href="#set-up-ssh-connection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Set up SSH connection</h2>
<p>Server side, install SSH server:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install openssh-server
</code></pre></div></div>

<p>Edit SSH configuration to whitelist users:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo vim /etc/ssh/sshd_config
</code></pre></div></div>

<p>Change root login permission line to: <code class="highlighter-rouge">PermitRootLogin no</code></p>

<p>Add allow users: <code class="highlighter-rouge">AllowUsers &lt;your_username&gt;</code></p>

<p>Then restart SSH server:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /etc/init.d/ssh restart
sudo ufw allow 22
</code></pre></div></div>

<p>Client side, to connect with the workstation, you need to firstly know the server’s IP (or hostname if it has one). Use ifconfig -a on the server to check IP address (look for that in eth0).</p>

<p>Client side (Mac OS), you need to whitelist the server IP in /etc/hosts:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo vim /etc/hosts
</code></pre></div></div>

<p>Add line <code class="highlighter-rouge">&lt;server IP&gt; &lt;server hostname&gt;</code></p>

<h2 id="port-forwarding-to-acess-jupyter-notebook-lan">
<a class="anchor" href="#port-forwarding-to-acess-jupyter-notebook-lan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Port Forwarding to Acess Jupyter Notebook (LAN)</h2>

<p>Within the home network, access the Jupyter Notebook on the Linux GPU server from a client machine’s browser by running</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -fNL 8888:local:8888 &lt;username_on_server&gt;@&lt;server_ip&gt;
</code></pre></div></div>

<p>and go to <code class="highlighter-rouge">localhost:8888/tree</code> in your browser.</p>

<h2 id="setup-remote-ssh-access-waninternet">
<a class="anchor" href="#setup-remote-ssh-access-waninternet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup Remote SSH Access (WAN/Internet)</h2>

<p>In my case, my Ubuntu machine with GPU sits at home behind a Verizon Fios router. I can directly ssh into it in my home network (LAN) but doing so from outside requires several additional steps.</p>

<h3 id="configure-router-for-port-forwarding">
<a class="anchor" href="#configure-router-for-port-forwarding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure Router for Port Forwarding</h3>

<p>For Verison Fios routers, go to <code class="highlighter-rouge">192.168.1.1</code> to access the router setting. In my case, the username is <code class="highlighter-rouge">admin</code> and the password is printed on my router.</p>

<p>In the page, find port forwarding, set <code class="highlighter-rouge">source</code> port to be <code class="highlighter-rouge">ANY</code>, <code class="highlighter-rouge">destination</code> port to be your custom port, say <code class="highlighter-rouge">2222</code>, and the port forward to is <code class="highlighter-rouge">22</code> which is the port on the box at which <code class="highlighter-rouge">ssh</code> is listening. Then click add. Done!</p>

<h3 id="ssh-from-remote">
<a class="anchor" href="#ssh-from-remote" aria-hidden="true"><span class="octicon octicon-link"></span></a>SSH from Remote</h3>

<p>Now, to log onto the box from outside, run</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh &lt;username&gt;@&lt;your_router_ip&gt; -p 2222
</code></pre></div></div>

<p>To simplify this, add a blob in <code class="highlighter-rouge">~/.ssh/config</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host deeplearningbox
    HostName &lt;router_public_ip&gt;
    User &lt;username_on_deeplearningbox&gt;
</code></pre></div></div>

<p>Now you can run <code class="highlighter-rouge">ssh deeplearningbox -p 2222</code></p>

<h2 id="setup-jupyter-notebook-server-for-remote-access">
<a class="anchor" href="#setup-jupyter-notebook-server-for-remote-access" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup Jupyter Notebook Server for Remote Access</h2>

<p>With remote ssh setup, now we setup Jupyter Notebook.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jupyter notebook --generate-config
</code></pre></div></div>

<p>which will generate <code class="highlighter-rouge">jupyter_notebook_config.py</code> in <code class="highlighter-rouge">~/.jupyter</code>.</p>

<p>Then generate certfile and key as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/.jupyter
$ openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mykey.key -out mycert.pem
</code></pre></div></div>

<p>Launch Python and run the following lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In [1]: from notebook.auth import passwd
In [2]: passwd()
Enter password:
Verify password:
Out[2]: 'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'
</code></pre></div></div>

<p>After that, edit the <code class="highlighter-rouge">jupyter_notebook_config.py</code> as following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c.NotebookApp.password = u'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'
# Set options for certfile, ip, password, and toggle off browser auto-opening
c.NotebookApp.certfile = u'/absolute/path/to/your/certificate/mycert.pem'
c.NotebookApp.keyfile = u'/absolute/path/to/your/certificate/mykey.key'

c.NotebookApp.ip = '0.0.0.0'
c.NotebookApp.open_browser = False

# It is a good idea to set a known, fixed port for server access
c.NotebookApp.port = 8888
</code></pre></div></div>

<p>Now, start <code class="highlighter-rouge">jupyter notebook</code> on the deep learning workstation and log in by</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -fNL 8888:localhost:8888 deeplearningbox -p 2222
</code></pre></div></div>

<p>Note that visit <code class="highlighter-rouge">https://localhost:8888</code> instead of <code class="highlighter-rouge">http</code> on the client computer.</p>

<h2 id="side-note-github-https">
<a class="anchor" href="#side-note-github-https" aria-hidden="true"><span class="octicon octicon-link"></span></a>Side Note: Github HTTPS</h2>

<p>Since I have 2FA authentication for my github account, using <code class="highlighter-rouge">https</code> as remote url for my repo needs “personal access token” which serves as password when pushing. Refer to <a href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line">this</a> for setup.</p>

<p>Using <code class="highlighter-rouge">SSH</code> instead of <code class="highlighter-rouge">HTTPS</code> is another option. But when the computer has two or more github account, setting up more key pairs and making things work is just <a href="https://stackoverflow.com/questions/3860112/multiple-github-accounts-on-the-same-computer">too much</a>. Since I prefer using my MBP (the machine with multiple Github accounts) over the Linux box for coding, sticking with <code class="highlighter-rouge">HTTPS</code> for the mac.</p>

<h2 id="side-note-ssh-port-forwarding-concepts">
<a class="anchor" href="#side-note-ssh-port-forwarding-concepts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Side Note: SSH Port Forwarding Concepts</h2>

<p>I’m a visual person. I found the answer <a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">here</a> helpful for explaining different types of port forwarding.</p>

<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
  <li><a href="https://course.fast.ai/start_aws.html">https://course.fast.ai/start_aws.html</a></li>
  <li><a href="https://github.com/charlesq34/DIY-Deep-Learning-Workstation">https://github.com/charlesq34/DIY-Deep-Learning-Workstation</a></li>
  <li><a href="https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot">https://unix.stackexchange.com/questions/115897/whats-ssh-port-forwarding-and-whats-the-difference-between-ssh-local-and-remot</a></li>
  <li><a href="https://superuser.com/questions/869417/port-forwarding-not-working-on-verizon-fios-router">https://superuser.com/questions/869417/port-forwarding-not-working-on-verizon-fios-router</a></li>
  <li><a href="https://fzhu.work/blog/python/remote-ipython-notebook-setup.html">https://fzhu.work/blog/python/remote-ipython-notebook-setup.html</a></li>
  <li><a href="https://tuatini.me/part-2-how-to-setup-your-own-environment-for-deep-learning-for-remote/">https://tuatini.me/part-2-how-to-setup-your-own-environment-for-deep-learning-for-remote/</a></li>
  <li><a href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line">https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line</a></li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="logancyang/blog-learning-automata"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/note/fastai/2019/05/27/fastai-gpu-setup.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Notes, code and essays by Logan Yang.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
