<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[Python Review] Part IV: Testing, Logging and Debugging | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[Python Review] Part IV: Testing, Logging and Debugging" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Stepping up Python skills" />
<meta property="og:description" content="Stepping up Python skills" />
<link rel="canonical" href="http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-04T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Stepping up Python skills","@type":"BlogPosting","headline":"[Python Review] Part IV: Testing, Logging and Debugging","dateModified":"2020-07-04T00:00:00-05:00","datePublished":"2020-07-04T00:00:00-05:00","url":"http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[Python Review] Part IV: Testing, Logging and Debugging | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[Python Review] Part IV: Testing, Logging and Debugging" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Stepping up Python skills" />
<meta property="og:description" content="Stepping up Python skills" />
<link rel="canonical" href="http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-04T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Stepping up Python skills","@type":"BlogPosting","headline":"[Python Review] Part IV: Testing, Logging and Debugging","dateModified":"2020-07-04T00:00:00-05:00","datePublished":"2020-07-04T00:00:00-05:00","url":"http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/python/2020/07/04/python-basics-iv.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Learning Automata</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[Python Review] Part IV: Testing, Logging and Debugging</h1><p class="page-description">Stepping up Python skills</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-07-04T00:00:00-05:00" itemprop="datePublished">
        Jul 4, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      9 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#note">note</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#testing">Testing</a>
<ul>
<li class="toc-entry toc-h3"><a href="#assertions">Assertions</a>
<ul>
<li class="toc-entry toc-h4"><a href="#contract-programming">Contract programming</a></li>
<li class="toc-entry toc-h4"><a href="#inline-tests">Inline tests</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#unittest-module">unittest module</a>
<ul>
<li class="toc-entry toc-h4"><a href="#using-unittest">Using unittest</a></li>
<li class="toc-entry toc-h4"><a href="#running-unittest">Running unittest</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#third-party-test-tools-pytest">Third-party test tools: pytest</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#logging">Logging</a>
<ul>
<li class="toc-entry toc-h3"><a href="#logging-basics">Logging basics</a></li>
<li class="toc-entry toc-h3"><a href="#logging-configuration">Logging configuration</a></li>
<li class="toc-entry toc-h3"><a href="#adding-logging-to-a-program">Adding logging to a program</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#debugging">Debugging</a>
<ul>
<li class="toc-entry toc-h3"><a href="#debugging-with-print">Debugging with print()</a></li>
<li class="toc-entry toc-h3"><a href="#debugging-with-the-python-debugger-pdb">Debugging with the Python debugger pdb</a></li>
<li class="toc-entry toc-h3"><a href="#develop-using-jupyter-notebook-and-nbdev">Develop using Jupyter Notebook and nbdev</a></li>
<li class="toc-entry toc-h3"><a href="#debugging-in-vscode">Debugging in VSCode</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#reference">Reference</a></li>
</ul><h2 id="testing">
<a class="anchor" href="#testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h2>

<p>The dynamic nature of Python makes testing critically important to most applications. There is no compiler to find your bugs. The only way to find bugs is to run the code and make sure you try out all of its features.</p>

<h3 id="assertions">
<a class="anchor" href="#assertions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Assertions</h3>

<p>The <code class="highlighter-rouge">assert</code> statement is an internal check for the program. If an expression is not true, it raises a <code class="highlighter-rouge">AssertionError</code> exception.</p>

<p><code class="highlighter-rouge">assert</code> statement syntax:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span> <span class="p">[,</span> <span class="s">'Diagnostic message'</span><span class="p">]</span>
</code></pre></div></div>

<p>For example,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">'Expected int'</span>
</code></pre></div></div>

<p>(<strong>BTW, the syntax of nested <code class="highlighter-rouge">[, arg]</code> in documentation <code class="highlighter-rouge">[, arg1 [, arg2 [...]]]</code> is the standard Python way of documenting function signatures. Check this <a href="https://stackoverflow.com/questions/2120507/why-do-python-function-docs-include-the-comma-after-the-bracket-for-optional-arg">post</a> for why.</strong>)</p>

<p>It shouldn’t be used to check the user-input (i.e., data entered on a web form or something). It’s purpose is more for internal checks and invariants (conditions that should always be true).</p>

<h4 id="contract-programming">
<a class="anchor" href="#contract-programming" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contract programming</h4>

<p>Also known as Design By Contract, liberal use of assertions is an approach for designing software. It prescribes that software designers should define precise interface specifications for the components of the software.</p>

<p>For example, you might put assertions on all inputs of a function.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">'Expected int'</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">'Expected int'</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="p">(</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="o">...</span>
<span class="nb">AssertionError</span><span class="p">:</span> <span class="n">Expected</span> <span class="nb">int</span>
</code></pre></div></div>

<p>Checking inputs will immediately catch callers who aren’t using appropriate arguments.</p>

<h4 id="inline-tests">
<a class="anchor" href="#inline-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inline tests</h4>

<p>Assertions can also be used for simple tests.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
</code></pre></div></div>

<p>This way you are including the test in the same module as your code. Benefit: <strong>If the code is obviously broken, attempts to import the module will crash.</strong></p>

<p>This is not recommended for exhaustive testing. It’s more of a basic “smoke test”. Does the function work on any example at all? If not, then something is definitely broken.</p>

<h3 id="unittest-module">
<a class="anchor" href="#unittest-module" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="highlighter-rouge">unittest</code> module</h3>

<p>Suppose you have a code file <code class="highlighter-rouge">simple.py</code>, and you write <code class="highlighter-rouge">test_simple.py</code> to test it:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># simple.py
</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="c1"># test_simple.py
</span>
<span class="kn">import</span> <span class="nn">simple</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="c1"># Notice that it inherits from unittest.TestCase
</span><span class="k">class</span> <span class="nc">TestAdd</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Test with simple integer arguments
</span>        <span class="n">r</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Test with strings
</span>        <span class="n">r</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'hello'</span><span class="p">,</span> <span class="s">'world'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">'helloworld'</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>The testing class must inherit from <code class="highlighter-rouge">unittest.TestCase</code>.</strong></p>

<p>In the testing class, you can define the testing methods.</p>

<p><em>Important</em>: Each method must start with <code class="highlighter-rouge">test</code>.</p>

<h4 id="using-unittest">
<a class="anchor" href="#using-unittest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using <code class="highlighter-rouge">unittest</code>
</h4>

<p>There are several built in assertions that come with <code class="highlighter-rouge">unittest</code>. Each of them asserts a different thing.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Assert that expr is True
</span><span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

<span class="c1"># Assert that x == y
</span><span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Assert that x != y
</span><span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Assert that x is near y
</span><span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">places</span><span class="p">)</span>

<span class="c1"># Assert that callable(arg1,arg2,...) raises exc
</span><span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>This is not an exhaustive list. There are other assertions in the module.</p>

<h4 id="running-unittest">
<a class="anchor" href="#running-unittest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running <code class="highlighter-rouge">unittest</code>
</h4>

<p>To run the tests, turn the code into a script.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># test_simple.py
</span>
<span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Then run Python on the test file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash % python3 test_simple.py
F.
========================================================
FAIL: test_simple (__main__.TestAdd)
--------------------------------------------------------
Traceback (most recent call last):
  File "testsimple.py", line 8, in test_simple
    self.assertEqual(r, 5)
AssertionError: 4 != 5
--------------------------------------------------------
Ran 2 tests in 0.000s
FAILED (failures=1)
</code></pre></div></div>

<p>When you run a test that checks the type of something, you need to check that an exception is raised:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TestStock</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">test_bad_shares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">stock</span><span class="o">.</span><span class="n">Stock</span><span class="p">(</span><span class="s">'GOOG'</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">490.1</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="nb">TypeError</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">shares</span> <span class="o">=</span> <span class="s">'100'</span>
</code></pre></div></div>

<p>Effective unit testing is an art and it can grow to be quite complicated for large applications.</p>

<p>The <code class="highlighter-rouge">unittest</code> module has a huge number of options related to test runners, collection of results and other aspects of testing. Consult the documentation for details.</p>

<h3 id="third-party-test-tools-pytest">
<a class="anchor" href="#third-party-test-tools-pytest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Third-party test tools: <code class="highlighter-rouge">pytest</code>
</h3>

<p>The built-in unittest module has the advantage of being available everywhere–it’s part of Python. However, many programmers also find it to be quite verbose. A popular alternative is <a href="https://docs.pytest.org/en/latest/">pytest</a>. With pytest, your testing file simplifies to something like the following:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># test_simple.py
</span><span class="kn">import</span> <span class="nn">simple</span>

<span class="k">def</span> <span class="nf">test_simple</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">simple</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>

<span class="k">def</span> <span class="nf">test_str</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">simple</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'hello'</span><span class="p">,</span><span class="s">'world'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'helloworld'</span>
</code></pre></div></div>

<p>To run the tests, you simply type a command such as <code class="highlighter-rouge">python -m pytest</code>. It will discover all of the tests and run them.</p>

<p>There’s a lot more to <code class="highlighter-rouge">pytest</code> than this example, but it’s usually pretty easy to get started should you decide to try it out.</p>

<h2 id="logging">
<a class="anchor" href="#logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging</h2>

<p>The <code class="highlighter-rouge">logging</code> module is a standard library module for recording diagnostic information. It’s also a very large module with a lot of sophisticated functionality. We will show a simple example to illustrate its usefulness.</p>

<p>Suppose we have:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># fileparse.py
</span><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">types</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="n">delimiter</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Couldn't parse :"</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Reason :"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">records</span>
</code></pre></div></div>

<p>We shouldn’t print the message when there’s an exception. Answer from <a href="https://stackoverflow.com/questions/6918493/in-python-why-use-logging-instead-of-print">stackoverflow</a>:</p>

<blockquote>
  <p>The logging package has a lot of useful features:</p>
</blockquote>

<blockquote>
  <ul>
    <li>Easy to see where and when (even what line no.) a logging call is being made from.</li>
    <li>You can log to files, sockets, pretty much anything, all at the same time.</li>
    <li>You can differentiate your logging based on severity.</li>
  </ul>
</blockquote>

<blockquote>
  <p>Print doesn’t have any of these.</p>
</blockquote>

<blockquote>
  <p>Also, if your project is meant to be imported by other python tools, it’s bad practice for your package to print things to stdout, since the user likely won’t know where the print messages are coming from. With logging, users of your package can choose whether or not they want to propogate logging messages from your tool or not.</p>
</blockquote>

<p>To use <code class="highlighter-rouge">logging</code> here:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># fileparse.py
</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># CREATE THE LOGGER OBJECT
</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">types</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="n">delimiter</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"Couldn't parse : </span><span class="si">%</span><span class="s">s"</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Reason : </span><span class="si">%</span><span class="s">s"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></div>

<p>The code is modified to issue warning messages via a <code class="highlighter-rouge">Logger</code> object. The one created with <code class="highlighter-rouge">logging.getLogger(__name__)</code>.</p>

<h3 id="logging-basics">
<a class="anchor" href="#logging-basics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging basics</h3>

<p><strong>Create a logger object:</strong></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>   <span class="c1"># name is a string
</span></code></pre></div></div>

<p>Issuing log messages.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">message</span> <span class="p">[,</span> <span class="n">args</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span> <span class="p">[,</span> <span class="n">args</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span> <span class="p">[,</span> <span class="n">args</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span> <span class="p">[,</span> <span class="n">args</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span> <span class="p">[,</span> <span class="n">args</span><span class="p">])</span>
</code></pre></div></div>

<p>Each method represents a <strong>different level of severity</strong>.</p>

<p>All of them create a formatted log message. <code class="highlighter-rouge">args</code> is used with the <code class="highlighter-rouge">%</code> operator to create the message.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">logmsg</span> <span class="o">=</span> <span class="n">message</span> <span class="o">%</span> <span class="n">args</span> <span class="c1"># Written to the log
</span></code></pre></div></div>

<h3 id="logging-configuration">
<a class="anchor" href="#logging-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging configuration</h3>

<p>Typically, this is a one-time configuration at program startup. The configuration is separate from the code that makes the logging calls.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.py
</span>
<span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">filename</span>  <span class="o">=</span> <span class="s">'app.log'</span><span class="p">,</span>      <span class="c1"># Log output file
</span>        <span class="n">level</span>     <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>   <span class="c1"># Output level
</span>    <span class="p">)</span>
</code></pre></div></div>

<p>Logging is highly configurable. You can adjust every aspect of it: output files, levels, message formats, etc. However, the code that uses logging doesn’t have to worry about that.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set level to DEBUG
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'fileparse'</span><span class="p">)</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">read_portfolio</span><span class="p">(</span><span class="s">'Data/missing.csv'</span><span class="p">)</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">fileparse</span><span class="p">:</span><span class="n">Row</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Bad</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="s">'MSFT'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">'51.23'</span><span class="p">]</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">fileparse</span><span class="p">:</span><span class="n">Row</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s">''</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">fileparse</span><span class="p">:</span><span class="n">Row</span> <span class="mi">7</span><span class="p">:</span> <span class="n">Bad</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="s">'IBM'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="s">'70.44'</span><span class="p">]</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">fileparse</span><span class="p">:</span><span class="n">Row</span> <span class="mi">7</span><span class="p">:</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s">''</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="c1"># Turn it off, set level to CRITICAL
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'fileparse'</span><span class="p">)</span><span class="o">.</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">read_portfolio</span><span class="p">(</span><span class="s">'Data/missing.csv'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="adding-logging-to-a-program">
<a class="anchor" href="#adding-logging-to-a-program" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding logging to a program</h3>

<p><strong>To add logging to an application, you need to have some mechanism to initialize the <code class="highlighter-rouge">logging</code> module in the <em>main module</em>. One way to do this is to include some setup code that looks like this:</strong></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This file sets up basic configuration of the logging module.
# Change settings here to adjust logging output as needed.
</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="c1"># Name of the log file (omit to use stderr)
</span>    <span class="n">filename</span> <span class="o">=</span> <span class="s">'app.log'</span><span class="p">,</span>
    <span class="c1"># File mode (use 'a' to append)
</span>    <span class="n">filemode</span> <span class="o">=</span> <span class="s">'w'</span><span class="p">,</span>
    <span class="c1"># Logging level (DEBUG, INFO, WARNING, ERROR, or CRITICAL)
</span>    <span class="n">level</span>    <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>You’d need to put this someplace in the startup steps of your program.</p>

<h2 id="debugging">
<a class="anchor" href="#debugging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debugging</h2>

<p>So, your program has crashed… Now what? Read the tracebacks!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash % python3 blah.py
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"blah.py"</span>, line 13, <span class="k">in</span> ?
    foo<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, line 10, <span class="k">in </span>foo
    bar<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, line 7, <span class="k">in </span>bar
    spam<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, 4, <span class="k">in </span>spam
    line x.append<span class="o">(</span>3<span class="o">)</span>
<span class="c"># Cause of the crash</span>
AttributeError: <span class="s1">'int'</span> object has no attribute <span class="s1">'append'</span>
</code></pre></div></div>

<p>PRO TIP: Paste the whole traceback to Google!</p>

<p>You can use <code class="highlighter-rouge">-i</code> to keep Python alive to Python REPL when executing in the shell:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash % python3 <span class="nt">-i</span> blah.py
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"blah.py"</span>, line 13, <span class="k">in</span> ?
    foo<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, line 10, <span class="k">in </span>foo
    bar<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, line 7, <span class="k">in </span>bar
    spam<span class="o">()</span>
  File <span class="s2">"blah.py"</span>, 4, <span class="k">in </span>spam
    line x.append<span class="o">(</span>3<span class="o">)</span>
AttributeError: <span class="s1">'int'</span> object has no attribute <span class="s1">'append'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>It preserves the interpreter state. That means that you can go poking around after the crash. Checking variable values and other state.</p>

<h3 id="debugging-with-print">
<a class="anchor" href="#debugging-with-print" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debugging with <code class="highlighter-rouge">print()</code>
</h3>

<p>Tip: use <code class="highlighter-rouge">repr()</code>. It shows details.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'DEBUG:'</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">'3.4'</span><span class="p">)</span>
<span class="c1"># NO `repr`
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="mf">3.4</span>
<span class="c1"># WITH `repr`
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">Decimal</span><span class="p">(</span><span class="s">'3.4'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h3 id="debugging-with-the-python-debugger-pdb">
<a class="anchor" href="#debugging-with-the-python-debugger-pdb" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debugging with the Python debugger <code class="highlighter-rouge">pdb</code>
</h3>

<p>You can manually launch the debugger inside a program.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">some_function</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="n">breakpoint</span><span class="p">()</span>      <span class="c1"># Enter the debugger (Python 3.7+)
</span>    <span class="o">...</span>
</code></pre></div></div>

<p>This starts the debugger at the <code class="highlighter-rouge">breakpoint()</code> call.</p>

<p>In earlier Python versions, you did this,</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pdb</span>
<span class="o">...</span>
<span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>       <span class="c1"># Instead of `breakpoint()`
</span><span class="o">...</span>
</code></pre></div></div>

<p>You can also run the entire program under debugger:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash % python3 <span class="nt">-m</span> pdb someprogram.py
</code></pre></div></div>

<p>It will automatically enter the debugger before the first statement. Allowing you to set breakpoints and change the configuration.</p>

<p>Common debugger commands:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Pdb) help            # Get help
(Pdb) w(here)         # Print stack trace
(Pdb) d(own)          # Move down one stack level
(Pdb) u(p)            # Move up one stack level
(Pdb) b(reak) loc     # Set a breakpoint
(Pdb) s(tep)          # Execute one instruction
(Pdb) c(ontinue)      # Continue execution
(Pdb) l(ist)          # List source code
(Pdb) a(rgs)          # Print args of current function
(Pdb) !statement      # Execute statement
</code></pre></div></div>

<p>Example for setting breakpoints:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Pdb) b 45            # Line 45 in current file
(Pdb) b file.py:45    # Line 34 in file.py
(Pdb) b foo           # Function foo() in current file
(Pdb) b module.foo    # Function foo() in a module
</code></pre></div></div>

<h3 id="develop-using-jupyter-notebook-and-nbdev">
<a class="anchor" href="#develop-using-jupyter-notebook-and-nbdev" aria-hidden="true"><span class="octicon octicon-link"></span></a>Develop using Jupyter Notebook and <code class="highlighter-rouge">nbdev</code>
</h3>

<p>Using Jupyter Notebook and <code class="highlighter-rouge">nbdev</code> by fast.ai is good for efficient debugging. Jupyter Notebook is a great tool for experimenting with code.</p>

<h3 id="debugging-in-vscode">
<a class="anchor" href="#debugging-in-vscode" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debugging in VSCode</h3>

<p>You can create a <code class="highlighter-rouge">py</code> file and use <code class="highlighter-rouge"># %%</code> to specify a cell which behaves like a Jupyter Notebook cell. Click at the beginning of any line in the source code to set a breakpoint, and run the cell with <code class="highlighter-rouge">Debug cell</code>.</p>

<p><img src="/images/misc/vscode-debug.png" alt="" align="middle"></p>

<h2 id="reference">
<a class="anchor" href="#reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference</h2>

<ul>
  <li><a href="https://dabeaz-course.github.io/practical-python/Notes">https://dabeaz-course.github.io/practical-python/Notes</a></li>
  <li><a href="https://stackoverflow.com/questions/2120507/why-do-python-function-docs-include-the-comma-after-the-bracket-for-optional-arg">https://stackoverflow.com/questions/2120507/why-do-python-function-docs-include-the-comma-after-the-bracket-for-optional-arg</a></li>
  <li><a href="https://stackoverflow.com/questions/6918493/in-python-why-use-logging-instead-of-print">https://stackoverflow.com/questions/6918493/in-python-why-use-logging-instead-of-print</a></li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="logancyang/blog-learning-automata"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/note/python/2020/07/04/python-basics-iv.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Notes, code and essays by Logan Yang.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
