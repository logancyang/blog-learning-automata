<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CS foundamentals for non-CS majors" />
<meta property="og:description" content="CS foundamentals for non-CS majors" />
<link rel="canonical" href="http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-29T00:00:00-05:00" />
<script type="application/ld+json">
{"dateModified":"2020-06-29T00:00:00-05:00","description":"CS foundamentals for non-CS majors","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html"},"@type":"BlogPosting","url":"http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html","headline":"[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory","datePublished":"2020-06-29T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CS foundamentals for non-CS majors" />
<meta property="og:description" content="CS foundamentals for non-CS majors" />
<link rel="canonical" href="http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-29T00:00:00-05:00" />
<script type="application/ld+json">
{"dateModified":"2020-06-29T00:00:00-05:00","description":"CS foundamentals for non-CS majors","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html"},"@type":"BlogPosting","url":"http://blog.logancyang.com/note/compsci/2020/06/29/computer-architecture-101.html","headline":"[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory","datePublished":"2020-06-29T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Learning Automata</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[From NAND to TETRIS] Computer Architecture 101 Part I: Logic Gates, ALU and Memory</h1><p class="page-description">CS foundamentals for non-CS majors</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-29T00:00:00-05:00" itemprop="datePublished">
        Jun 29, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      12 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#note">note</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#compsci">compsci</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#level-1-boolean-operations-and-logic-gates">Level 1. Boolean operations and logic gates</a>
<ul>
<li class="toc-entry toc-h3"><a href="#the-amazing-nand-operation">The amazing NAND operation</a></li>
<li class="toc-entry toc-h3"><a href="#multi-bit-buses-an-array-of-bits-as-one-entity">Multi-bit buses: an array of bits as one entity</a></li>
<li class="toc-entry toc-h3"><a href="#programmable-elementary-gates">Programmable elementary gates</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#level-2-boolean-arithmetic-and-arithmetic-logic-unit-alu">Level 2. Boolean arithmetic and Arithmetic Logic Unit (ALU)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#building-an-adder">Building an adder</a></li>
<li class="toc-entry toc-h3"><a href="#negative-numbers">Negative numbers</a>
<ul>
<li class="toc-entry toc-h4"><a href="#negative-addition">Negative addition</a></li>
<li class="toc-entry toc-h4"><a href="#negative-subtraction-solve-negation-first">Negative subtraction: solve negation first</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#arithmetic-logic-unit-alu">Arithmetic Logic Unit (ALU)</a></li>
<li class="toc-entry toc-h3"><a href="#comments">Comments</a>
<ul>
<li class="toc-entry toc-h4"><a href="#hardware--software-tradeoff">Hardware / software tradeoff</a></li>
<li class="toc-entry toc-h4"><a href="#unit-testing">Unit testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#level-3-memory">Level 3. Memory</a>
<ul>
<li class="toc-entry toc-h3"><a href="#time">Time</a></li>
<li class="toc-entry toc-h3"><a href="#combinatorial-vs-sequential-logic">Combinatorial vs. sequential logic</a></li>
<li class="toc-entry toc-h3"><a href="#flip-flops-hardware-that-implements-the-sequential-logic">Flip Flops: Hardware that implements the sequential logic</a></li>
<li class="toc-entry toc-h3"><a href="#1-bit-register">1-bit register</a></li>
<li class="toc-entry toc-h3"><a href="#the-memory-unit">The Memory Unit</a></li>
<li class="toc-entry toc-h3"><a href="#the-counter">The Counter</a></li>
<li class="toc-entry toc-h3"><a href="#rom-vs-ram-vs-flash-vs-cache-memory">ROM vs. RAM vs. Flash vs. Cache memory</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#reference">Reference</a></li>
</ul><p>Ever wondered how a computer executes your code with those tiny silicon thingys? If it sounds like a mystery to you, you need to read this article.</p>

<p>A computer system is a multiple-layer abstraction. You worry about <em>what</em> you want to do using <em>interfaces</em> that are <em>abstracted away</em> from you. Getting to know what the abstractions are and having an rough idea of how they work under the hood is an important and often overlooked prerequisite for a good coder. If you don’t have this knowledge as a data scientist or software developer, you will feel you work on top of a floating and unreliable foundation.</p>

<p>In this article, I will introduce all the concepts in an easily consumable manner by walking through the process of building a general purpose computer called Hack from the ground up using first principles.</p>

<p><img src="/images/cs4ds/hack.png" alt="" align="middle"></p>

<p>After this exercise, you will walk away more confident and eliminate the insecurities of not knowing the foundational knowledge of computers.</p>

<p>Ready? Let’s get started and go through the <strong>levels of abstractions</strong> in the computer system.</p>

<p><img src="/images/cs4ds/abstractions.png" alt="" align="middle"></p>

<h2 id="level-1-boolean-operations-and-logic-gates">
<a class="anchor" href="#level-1-boolean-operations-and-logic-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Level 1. Boolean operations and logic gates</h2>

<p><img src="/images/cs4ds/booleanops.png" alt="" align="middle"></p>

<p>Booleans functions -&gt; truth table.</p>

<p><img src="/images/cs4ds/truthtable.png" alt="" align="middle"></p>

<p>Boolean algebra laws</p>

<p><img src="/images/cs4ds/boollaws.png" alt="" align="middle"></p>

<p>How to construct a function from basic operations? (how to construct hardware)</p>

<p>Find all the 1s in truth table, write an expression for each, and OR them together! We can further simplify the expression. However, finding the shortest expression is NP hard.</p>

<blockquote>
  <p>Any boolean function can be constructed with AND and NOT operations.</p>
</blockquote>

<p>OR can be constructed with AND and NOT.</p>

<p><img src="/images/cs4ds/constructbool.png" alt="" align="middle"></p>

<h3 id="the-amazing-nand-operation">
<a class="anchor" href="#the-amazing-nand-operation" aria-hidden="true"><span class="octicon octicon-link"></span></a>The amazing NAND operation</h3>

<blockquote>
  <p>Any boolean function can be constructed with NAND operations.</p>
</blockquote>

<p>Because AND and NOT can be constructed with only the NAND gate.</p>

<p><img src="/images/cs4ds/nand.png" alt="" align="middle"></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Def: NAND
x NAND y = NOT(x AND y)

# NAND =&gt; NOT
NOT(x) = x NAND x

# NAND =&gt; AND
x AND y = NOT(x NAND y)
</code></pre></div></div>

<p>Logic gates are physical chips consisting of transistors that actually implement these boolean operations. We can use elementary logic gates such as AND, OR, NAND to construct composite gates.</p>

<p>Electrical engineers are responsible for constructing these gates with circuits and transistors. These chips have very clear specifications.</p>

<p><img src="/images/cs4ds/andtransistor.png" alt="" align="middle">
(wikipedia and gate)</p>

<p>We are not going to dive into the design of the circuit. We take the specifications of inputs and outputs and use them to build more complex logic. There is a type of language called Hardware Description Language (HDL) that can be used in this process. The two most popular HDLs are VHDL and Verilog, and there are others as well.</p>

<p>Designing composite gates from elementary ones takes experience. Here is an example of XOR built with AND, OR and NOT.</p>

<p><img src="/images/cs4ds/designxor.png" alt="" align="middle"></p>

<p>We can write HDL code and load it into a hardware simulator, run test scripts to make sure it works.</p>

<p><img src="/images/cs4ds/hardwaresim.png" alt="" align="middle"></p>

<p>A hardware construction project usually involves a system architect and some developers. The system architect breaks down the task into an overall chip API and smaller individual chips, and the developers build them using HDL.</p>

<h3 id="multi-bit-buses-an-array-of-bits-as-one-entity">
<a class="anchor" href="#multi-bit-buses-an-array-of-bits-as-one-entity" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi-bit buses: an array of bits as one entity</h3>

<p>When we manipulate many bits together, like adding two 16-bit integers, we can think of the bits as groups. Each group or array of bits is called “bus”. HDL provides ways to manipulate buses as arrays.</p>

<p><img src="/images/cs4ds/hdlbus.png" alt="" align="middle"></p>

<p>These buses are indexed from right to left. Right means the least significant bit.</p>

<h3 id="programmable-elementary-gates">
<a class="anchor" href="#programmable-elementary-gates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Programmable elementary gates</h3>

<p>The mutiplexor gate <code class="highlighter-rouge">mux</code> is an example of programmable gates. You give it a “selected bit” <code class="highlighter-rouge">sel</code> and it selects one of the inputs to be the output. This is a foundamental operations that exists in all kinds of programs.</p>

<p><img src="/images/cs4ds/mux.png" alt="" align="middle"></p>

<p><img src="/images/cs4ds/muxprogrammable.png" alt="" align="middle"></p>

<p>The demultiplexor gate <code class="highlighter-rouge">dmux</code> is the inverse of <code class="highlighter-rouge">mux</code>.</p>

<p><img src="/images/cs4ds/demux.png" alt="" align="middle"></p>

<p>A concrete example of an application using <code class="highlighter-rouge">mux</code> and <code class="highlighter-rouge">dmux</code> is a single communication line that interleaves two (or more) messages together!</p>

<p><img src="/images/cs4ds/muxdemux.png" alt="" align="middle"></p>

<h2 id="level-2-boolean-arithmetic-and-arithmetic-logic-unit-alu">
<a class="anchor" href="#level-2-boolean-arithmetic-and-arithmetic-logic-unit-alu" aria-hidden="true"><span class="octicon octicon-link"></span></a>Level 2. Boolean arithmetic and Arithmetic Logic Unit (ALU)</h2>

<p>Doing binary addition is similar to decimal addition except that we carry over 1 to the next digit one position reaches 2 and not 10.</p>

<p>For an 8-bit binary number, we call “8” the <strong>word size</strong>. Anything outside the range of 8-bit representation is going to cause “overflow”</p>

<p>What the computer does when faced with overflow is just to ignore the overflow and truncate the result back to the word size.</p>

<p><img src="/images/cs4ds/overflow.png" alt="" align="middle"></p>

<h3 id="building-an-adder">
<a class="anchor" href="#building-an-adder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building an adder</h3>

<p>First we look at a “half adder”. It takes in 2 bits and outputs a sum bit and a carry bit. The carry bit is 1 when the sum reaches 2.</p>

<p><img src="/images/cs4ds/halfadder.png" alt="" align="middle"></p>

<p>Then we can build a “full adder” that takes in 2 bits and a carry bit from a previous addition, and outputs a sum bit and a carry bit.</p>

<p><img src="/images/cs4ds/fulladder-diagram.png" alt="" align="middle"></p>

<p><img src="/images/cs4ds/fulladder.png" alt="" align="middle"></p>

<p>With a half adder for the least significant bit, and several full adders, we can build a multi-bit adder, say, for 16-bit binary numbers.</p>

<p><img src="/images/cs4ds/multibitadder.png" alt="" align="middle"></p>

<p><img src="/images/cs4ds/adder.png" alt="" align="middle"></p>

<h3 id="negative-numbers">
<a class="anchor" href="#negative-numbers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Negative numbers</h3>

<p>We could use the first bit as the sign and the remaining bits for the actual number. But this approach has problems such as -0 and we need extra logic to handle subtraction.</p>

<p>The approach we actually use is called the 2’s complement.</p>

<p><img src="/images/cs4ds/twoscomp.png" alt="" align="middle"></p>

<h4 id="negative-addition">
<a class="anchor" href="#negative-addition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Negative addition</h4>

<p>Negative addition comes for free because we throw away the overflowing bit, i.e. do a modulo $2^n$.</p>

<p><img src="/images/cs4ds/negadd.png" alt="" align="middle"></p>

<h4 id="negative-subtraction-solve-negation-first">
<a class="anchor" href="#negative-subtraction-solve-negation-first" aria-hidden="true"><span class="octicon octicon-link"></span></a>Negative subtraction: solve negation first</h4>

<p>We use a math trick,</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mi>x</mi><mo>=</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">2^n - x = 1 + (2^n - 1) - x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7977219999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span></span>

<p>We use it for these reasons:</p>

<ol>
  <li>Since $2^n - x = -x$ in our 2’s complement representation, the left hand side is <code class="highlighter-rouge">-x</code>.</li>
  <li>$(2^n - 1)$ in binary is <code class="highlighter-rouge">11111...1</code>, just <code class="highlighter-rouge">n</code> 1’s, subtracting a binary number <code class="highlighter-rouge">x</code> from it is easy - just flip all its bits!</li>
  <li>Now we have $(2^n - 1) - x$ in binary, adding 1 is trivial.</li>
</ol>

<p><img src="/images/cs4ds/negsub.png" alt="" align="middle"></p>

<h3 id="arithmetic-logic-unit-alu">
<a class="anchor" href="#arithmetic-logic-unit-alu" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arithmetic Logic Unit (ALU)</h3>

<p>The famous Von Neumann architecture</p>

<p><img src="/images/cs4ds/vonarch.png" alt="" align="middle"></p>

<p>ALU performs a function on input bits</p>

<p><img src="/images/cs4ds/alu.png" alt="" align="middle"></p>

<p>For the Hack computer we are building, we define the Hack ALU as follows,</p>

<p><img src="/images/cs4ds/hackalu.png" alt="" align="middle"></p>

<p>The pins at the top are the control bits.</p>

<p>The output of the ALU is determined completely by the truth table below,</p>

<p><img src="/images/cs4ds/hackalu-truthtable.png" alt="" align="middle"></p>

<p>There are many more functions we can compute, but we choose these ones for Hack.</p>

<p>The control bits are directives that ALU examines and <strong>executes from left to right sequentially</strong>.</p>

<ul>
  <li>
<code class="highlighter-rouge">if zx then x = 0</code>, zero all bits of x.</li>
  <li>
<code class="highlighter-rouge">if nx then x != x</code>, flip all bits of x.</li>
  <li>
<code class="highlighter-rouge">if zy then y = 0</code>, zero all bits of y.</li>
  <li>
<code class="highlighter-rouge">if ny then y != y</code>, flip all bits of y.</li>
  <li><code class="highlighter-rouge">if f then out = x + y, else out = x &amp; y</code></li>
  <li>
<code class="highlighter-rouge">if no then out != out</code>, flip all bits of out.</li>
</ul>

<p>You can check one operation, i.e. a row in the following truth table and verify that these sequential control directives output the right output for the desired operation on the inputs.</p>

<p><img src="/images/cs4ds/alu-example.png" alt="" align="middle"></p>

<p>We also have <strong>output control bits</strong> <code class="highlighter-rouge">zr</code> and <code class="highlighter-rouge">ng</code> defined as follows,</p>

<p><img src="/images/cs4ds/aluoutputcontrol.png" alt="" align="middle"></p>

<p>Why do we need these output control bits? The reason will become clear when we have the big picture of computer architecture.</p>

<p>The Hack ALU is simple, elegant and easy to implement.</p>

<blockquote>
  <p>Leonardo da Vinci: Simplicity is the ultimate sophistication.</p>
</blockquote>

<p>However, keep in mind that this is an extremely simplified version of the ALU. The real ALU in computers are much more complicated.</p>

<h3 id="comments">
<a class="anchor" href="#comments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comments</h3>

<h4 id="hardware--software-tradeoff">
<a class="anchor" href="#hardware--software-tradeoff" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware / software tradeoff</h4>

<p>There is a tradeoff between the hardware and software. For example, we can let the hardware do multiplication and division instead using software. A complex hardware is faster for operations but more costly to design and manufacture. It’s the freedom of the hardware designer to decide whether to move some operations to software.</p>

<h4 id="unit-testing">
<a class="anchor" href="#unit-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unit testing</h4>

<p>You might know that in software development we have unit tests. Actually, the idea comes from hardware development since we can isolate one logic unit and test whether it works correctly with its defined interfaces.</p>

<blockquote>
  <p>Unit tests conceptually break a program into discrete pieces and test each piece in isolation, while integration tests make sure that the pieces are working properly together as a whole. Unit tests are generally small and don’t take much time to write because they only test a small section of code.</p>
</blockquote>

<h2 id="level-3-memory">
<a class="anchor" href="#level-3-memory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Level 3. Memory</h2>

<h3 id="time">
<a class="anchor" href="#time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Time</h3>

<p>Now we will learn how the computer executes one thing after another, i.e. how it perceives <strong>time</strong>.</p>

<p>The way we let a computer perceive time is to use some kind of digital oscillator as a discrete time clock. This way we convert physical time into discrete time.</p>

<p>Since the hardware uses voltage to represent bit state 0 and 1, and it takes time for the hardware to stablize after a state transition, we design the unit time step in the discrete clock to be slightly bigger than the time it takes to stablize. We then sample the stable state to be the state of that time unit.</p>

<p>A time unit is at the atomic level, <strong>the computer only knows one state within one time unit</strong>.</p>

<p><img src="/images/cs4ds/clock.png" alt="" align="middle"></p>

<h3 id="combinatorial-vs-sequential-logic">
<a class="anchor" href="#combinatorial-vs-sequential-logic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Combinatorial vs. sequential logic</h3>

<p>Combinatorial logic just means that the output for a time unit only depends on the input in that time unit.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>out[t] = function(in[t])
</code></pre></div></div>

<p>Sequential logic means we <strong>use the same wire to store the bit</strong>, and current step’s output depends on the last time step.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>state[t] = function(state[t-1])
</code></pre></div></div>

<p>This is the prototype of the <strong>iterator</strong>. With the sequential logic we can operate with time as input to our function.</p>

<p><img src="/images/cs4ds/sequential.png" alt="" align="middle"></p>

<h3 id="flip-flops-hardware-that-implements-the-sequential-logic">
<a class="anchor" href="#flip-flops-hardware-that-implements-the-sequential-logic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flip Flops: Hardware that implements the sequential logic</h3>

<p>Previously we had logic gates and ALUs that can compute a variety of operations, but we are missing one key piece to enable sequential logic: the hardware to remember the state from time t-1 to time t. How to do that?</p>

<p>We need something called the Clocked Data Flip Flop. Its output is input shifted one step forward.</p>

<p><img src="/images/cs4ds/dff.png" alt="" align="middle"></p>

<p>The little triangle in the diagram means it has a time-dependent chip. The combinatorial chips get the outputs instantaneously, while the sequential logic chips are time-dependent.</p>

<p>Conceptually, with the NAND gate and the Data Flip Flop as a foundation, we can build everything needed in a computer!</p>

<p>We are not going to describe how the flip flops are built physically here. The digital circuit is quite clever and elegant though. If you are interested, read about it <a href="https://en.wikipedia.org/wiki/Flip-flop_(electronics)#D_flip-flop">here</a>.</p>

<h3 id="1-bit-register">
<a class="anchor" href="#1-bit-register" aria-hidden="true"><span class="octicon octicon-link"></span></a>1-bit register</h3>

<p>We can build a chip by using the D Flip Flop that remembers the last input state when the load state is 1.</p>

<p><img src="/images/cs4ds/onebitreg.png" alt="" align="middle"></p>

<p>The logic is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if load(t-1):
    out[t] = in[t-1]
else:
    out[t] = out[t-1]
</code></pre></div></div>

<p>A load of 1 at t-1 means we need to remember the input at t-1 from now on until a next load of 1 regardless of how input changes during this period.</p>

<p>How to implement a 1-bit register using the D Flip Flop? Recall the <strong>mutiplexor</strong> (select one of two inputs based on a “select” bit).</p>

<p><img src="/images/cs4ds/onebitreg-mux.png" alt="" align="middle"></p>

<p>With the 1-bit register, we can start to build the memory unit!</p>

<h3 id="the-memory-unit">
<a class="anchor" href="#the-memory-unit" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Memory Unit</h3>

<p>There are different types of memory. The most important type is the RAM. <strong>It stores both data and instructions</strong>.</p>

<p>It is a <strong>volatile device</strong> meaning it depends on an external power supply to store information. Physically it is not like the disk or ROM (read-only memory), it clears everything whenever the computer is disconnected from power while in the disk or ROM, info is persisted.</p>

<p><img src="/images/cs4ds/memorypic.png" alt="" align="middle"></p>

<p>We can build an N-bit register by putting N 1-bit registers side by side. Here we talk about 16-bit registers without loss of generality. The register’s <strong>state</strong> is the value stored in the register. To lookup the state, we just need to probe its output pins.</p>

<p>To store a new input state <code class="highlighter-rouge">v</code>, we set <code class="highlighter-rouge">load</code> to 1 at that time step.</p>

<p><strong>The RAM abstraction: A sequence of <em>n</em> addressable registers with addresses 0 to n-1.</strong></p>

<p><strong>Important: At any given time, ONLY ONE REGISTER in the RAM is selected!</strong></p>

<p>Since we have <em>n</em> addressable registers, we need a binary number to represent the address. Turning <em>n</em> to a binary number, we say it has <em>k</em> bits. So <code class="highlighter-rouge">k = log2(n)</code>.</p>

<p><img src="/images/cs4ds/memoryparams.png" alt="" align="middle"></p>

<p><strong>RAM is a sequential chip with a clocked behavior.</strong></p>

<blockquote>
  <p>Why is it called Random Access Memory?</p>
</blockquote>

<blockquote>
  <p>A: Because regardless of how many registers the memory unit has, be it 1 million or 1 billion, it takes exactly the same access time to access any one of the registers with a given address!</p>
</blockquote>

<p>Some different RAM chips:</p>

<p><img src="/images/cs4ds/ramchips.png" alt="" align="middle"></p>

<h3 id="the-counter">
<a class="anchor" href="#the-counter" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Counter</h3>

<p>A Program Counter (PC) is a chip (hardware device) that realizes the following 3 abstractions:</p>

<ol>
  <li>Reset: fetch the first instruction, PC = 0</li>
  <li>Next: fetch the next instruction, PC++</li>
  <li>Goto: fetch instruction n, PC = n</li>
</ol>

<p>Here is the logic the Counter does:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if reset[t] == 1:
    out[t+1] = 0  # reset counter to 0
elif load[t] == 1:
    out[t+1] = in[t]  # set counter to input value at t
elif inc[t] == 1:
    out[t+1] = out[t] + 1  # increment counter by 1
else:
    out[t+1] = out[t]  # maintain the last value
</code></pre></div></div>

<p><img src="/images/cs4ds/counter.png" alt="" align="middle"></p>

<h3 id="rom-vs-ram-vs-flash-vs-cache-memory">
<a class="anchor" href="#rom-vs-ram-vs-flash-vs-cache-memory" aria-hidden="true"><span class="octicon octicon-link"></span></a>ROM vs. RAM vs. Flash vs. Cache memory</h3>

<p>The ROM (read-only memory) is an involatile device that keeps information persisted even without external power supply. For example, it is used in the computer booting process for this reason.</p>

<p>Another technology is flash memory. It combines the good things of both ROM and RAM, it doesn’t need external power supply to persist data, and is writable.</p>

<p>Cache memory is a small and expensive memory that is close to the processor. It has very high performance. There is a hierarchy of cache memories, the closer to the processor, the faster, smaller and more expensive it gets.</p>

<p><a href="http://blog.logancyang.com/note/compsci/2020/07/02/computer-architecture-101-part-ii.html">Go to Part II</a></p>

<h2 id="reference">
<a class="anchor" href="#reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference</h2>

<p><a href="https://www.coursera.org/learn/build-a-computer">Coursera From NAND To TETRIS</a></p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="logancyang/blog-learning-automata"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/note/compsci/2020/06/29/computer-architecture-101.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Notes, code and essays by Logan Yang.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
