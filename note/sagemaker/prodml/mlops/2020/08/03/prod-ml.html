<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[Production Machine Learning] Amazon SageMaker Part I | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[Production Machine Learning] Amazon SageMaker Part I" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ProdML SageMaker note series" />
<meta property="og:description" content="ProdML SageMaker note series" />
<link rel="canonical" href="http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-03T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"ProdML SageMaker note series","@type":"BlogPosting","headline":"[Production Machine Learning] Amazon SageMaker Part I","dateModified":"2020-08-03T00:00:00-05:00","datePublished":"2020-08-03T00:00:00-05:00","url":"http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[Production Machine Learning] Amazon SageMaker Part I | Learning Automata</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="[Production Machine Learning] Amazon SageMaker Part I" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ProdML SageMaker note series" />
<meta property="og:description" content="ProdML SageMaker note series" />
<link rel="canonical" href="http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html" />
<meta property="og:url" content="http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html" />
<meta property="og:site_name" content="Learning Automata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-03T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"ProdML SageMaker note series","@type":"BlogPosting","headline":"[Production Machine Learning] Amazon SageMaker Part I","dateModified":"2020-08-03T00:00:00-05:00","datePublished":"2020-08-03T00:00:00-05:00","url":"http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.logancyang.com/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="http://blog.logancyang.com/feed.xml" title="Learning Automata" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-164976898-2','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Learning Automata</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">[Production Machine Learning] Amazon SageMaker Part I</h1><p class="page-description">ProdML SageMaker note series</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-03T00:00:00-05:00" itemprop="datePublished">
        Aug 3, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#note">note</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#sagemaker">sagemaker</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#prodml">prodml</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#mlops">mlops</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#overview">Overview</a>
<ul>
<li class="toc-entry toc-h3"><a href="#challenges-of-running-production-ml-systems">Challenges of running production ML systems</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#1-intro-to-amazon-sagemaker">1. Intro to Amazon SageMaker</a></li>
<li class="toc-entry toc-h2"><a href="#sagemaker-architecture-overview">SageMaker architecture overview</a></li>
<li class="toc-entry toc-h2"><a href="#2-sagemaker-studio">2. SageMaker Studio</a>
<ul>
<li class="toc-entry toc-h3"><a href="#21-create-a-studio-instance">2.1 Create a Studio instance</a></li>
<li class="toc-entry toc-h3"><a href="#22-create-a-notebook">2.2 Create a notebook</a></li>
<li class="toc-entry toc-h3"><a href="#connect-to-a-git-repo-in-studio">Connect to a git repo in Studio</a></li>
</ul>
</li>
</ul><h2 id="overview">
<a class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<ol>
  <li>
<strong>Intro to Amazon SageMaker</strong>: what it is, what it sovles</li>
  <li>
<strong>Setting up a SageMaker Studio development environment</strong>: create an instance of SageMaker Studio, and learn about its GUI, create Jupyter notebooks, and connect to git repos.</li>
  <li>
<strong>Interactive model tranining in SageMaker Studio</strong>: train model using builtin models and custom scripts, build Docker images for custom solution. Interact with SageMaker API using its Python SDK.</li>
  <li>
<strong>Experiment management using Experiments</strong>: train both TensorFlow and PyTorch to train CV models, and run experiments to find the best model</li>
  <li>
<strong>Deploy trained models</strong>: run batch offline inference, and deploy as API for production online inference. We will also show how to scale the production resource based on demand.</li>
  <li>
<strong>Monitoring deployed models</strong>: use SageMaker Model Monitor to monitor the model deployed in 5, inspect incoming data with training data to find if there is data drift</li>
</ol>

<h3 id="challenges-of-running-production-ml-systems">
<a class="anchor" href="#challenges-of-running-production-ml-systems" aria-hidden="true"><span class="octicon octicon-link"></span></a>Challenges of running production ML systems</h3>

<ul>
  <li>
<strong>Experimentation tracking</strong>: selecting the best model from many iterations is hard</li>
  <li>
<strong>Debugging</strong>: debugging in ML is hard, debugging an automated ML job is harder</li>
  <li>
<strong>Deployment</strong>: deployment is not well understood since most data scientists lack DevOps and software engineering skills</li>
  <li>
<strong>Scaling</strong>: instances need to automatically scale based on demand</li>
  <li>
<strong>Model monitoring</strong>: models need to be monitored to identify regressions in quality, and provide signal for actions such as <strong>model retraining, auditing upstream, fix data quality issues</strong>.</li>
</ul>

<p>We will solve these challenges with Amazon SageMaker! We will be able to</p>

<ul>
  <li>train models using built-in algorithms and custom scripts</li>
  <li>run large scale experiments in an autoscaling distributed environment</li>
  <li>collect and analyze data from experiments</li>
  <li>perform offline inference on batch data</li>
  <li>deploy models as persistent endpoints that scale with demand</li>
  <li>monitor deployed endpoints for data drift</li>
</ul>

<h2 id="1-intro-to-amazon-sagemaker">
<a class="anchor" href="#1-intro-to-amazon-sagemaker" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Intro to Amazon SageMaker</h2>

<p>SageMaker is an ML platform. That means it lets you quickly train and deploy ML models to production.</p>

<p>It takes care of a lot of “plumbing” tasks for ML systems. These tasks are NOT feature engineering and algorithmic work. They are more mundane ones such as managing infra, logging, monitoring inputs and outputs. They enable us to do algorithmic work much easier.</p>

<p>SageMaker features:</p>

<ul>
  <li>
<strong>Studio</strong> - integrated ML environment where you can build, train, deploy, and analyze your models in one place.</li>
  <li>
<strong>Studio notebooks</strong> - Jupyter notebook interface with Single Sign-On integration, fast startup time, and single click sharing</li>
  <li>
<strong>Preprocessing</strong> - preprocess and analyze data over a distributed cluster</li>
  <li>
<strong>Experimenst</strong> - experiment management and tracking</li>
  <li>
<strong>Debugger</strong> - inspect data and error in automated training processes</li>
  <li>
<strong>Batch transform</strong> - perform batch inference</li>
  <li>
<strong>Hosted endpoints</strong> - deploy models as APIs</li>
  <li>
<strong>Model monitor</strong> - monitor model quality</li>
</ul>

<h2 id="sagemaker-architecture-overview">
<a class="anchor" href="#sagemaker-architecture-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>SageMaker architecture overview</h2>

<p>SageMaker consists of several services.</p>

<ul>
  <li>Docker: depending on your use case. To use builtin models, no need to work with Docker. If you have customized model and solutions, you need to build and publish Docker images.</li>
  <li>Elastic Container Registry (ECR): this is an AWS service. SageMaker gets the desired Docker image from ECR to run the job. Amazon has predefined Docker images for SageMaker to do basic things. We will use them later.</li>
  <li>S3: SageMaker stores and gets the data in S3.</li>
  <li>EC2: SageMaker launches EC2 instances to do the work and terminate when the job is complete. You only pay for the use. If you choose to deploy as an API, SageMaker launches the number of instances as you specify and does not terminate them. You can let it scale as needed.</li>
</ul>

<p><img src="/images/prodml/sagemaker-arch.png" alt="SageMaker architecture" align="middle"></p>

<p>And there are 2 background services that are not directly relevant in the architecture but also important:</p>

<ul>
  <li>CloudWatch: it monitors the resources and stores log files</li>
  <li>IAM: Amazon uses Identity and Access Management users to manage your access.</li>
</ul>

<h2 id="2-sagemaker-studio">
<a class="anchor" href="#2-sagemaker-studio" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. SageMaker Studio</h2>

<p>Features</p>

<ul>
  <li>Notebooks</li>
  <li>Experiments</li>
  <li>Autopilot (enable developers with no ML expertise to train models)</li>
  <li>Debugger</li>
  <li>Model Monitor</li>
</ul>

<h3 id="21-create-a-studio-instance">
<a class="anchor" href="#21-create-a-studio-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 Create a Studio instance</h3>

<p>In quick start, set your username,</p>

<p><img src="/images/prodml/sagemaker-create1.png" alt="Studio create 1" align="middle"></p>

<p>then create a new IAM role, leave the S3 setting to default unless you have special naming requirements.</p>

<p><img src="/images/prodml/sagemaker-create2.png" alt="Studio create 2" align="middle"></p>

<p>After creating the new IAM role, hit submit to create the SageMaker Studio instance. You’ll see the following page and it will take a couple of minutes.</p>

<p><img src="/images/prodml/sagemaker-create3.png" alt="Studio create 3" align="middle"></p>

<h3 id="22-create-a-notebook">
<a class="anchor" href="#22-create-a-notebook" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2 Create a notebook</h3>

<p>Once the Studio instance is created, click on file -&gt; new -&gt; notebook, select a kernel to start a new notebook. After that, the bottom left has a green message that should say “kernel starting”, and at the top right there is “unknown” meaning the EC2 resource underlying the kernel is not ready yet. During the starting phase, you can’t run any notebook code. Just wait for a while. Once it’s ready, the “unknown” should turn to something like “2 vCPU + 4 GB”.</p>

<p>The kernel tab on the left sidebar shows the active kernels (Docker images) you are running.</p>

<p><img src="/images/prodml/sagemaker-nb-kernel.png" alt="Kernel" align="middle"></p>

<p>The “Python3 (Data Science)” kernel has the usual data science libraries pre-installed.</p>

<p><img src="/images/prodml/ds-kernel.png" alt="Kernel DS" align="middle"></p>

<p><strong>Don’t forget to stop the kernel when you are done!</strong></p>

<h3 id="connect-to-a-git-repo-in-studio">
<a class="anchor" href="#connect-to-a-git-repo-in-studio" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connect to a git repo in Studio</h3>

<p>Click file -&gt; new -&gt; terminal, it opens a bash terminal for us. <code class="highlighter-rouge">git clone</code> your desired repo from Github.</p>

<p>Now you should see your repo’s directory in the file browser in the left sidebar. You can also check the git history and status in the git tab in the sidebar.</p>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="logancyang/blog-learning-automata"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/note/sagemaker/prodml/mlops/2020/08/03/prod-ml.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Notes, code and essays by Logan Yang.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/logancyang" title="logancyang"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
